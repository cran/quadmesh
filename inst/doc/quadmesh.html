<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Michael D. Sumner" />

<meta name="date" content="2022-08-31" />

<title>Quadmesh</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Quadmesh</h1>
<h4 class="author">Michael D. Sumner</h4>
<h4 class="date">2022-08-31</h4>



<div id="quadmesh" class="section level1">
<h1>quadmesh</h1>
<p>Build a “quadmesh” in R.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quadmesh)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span></code></pre></div>
<pre><code>## Loading required package: sp</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(volcano)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>volcano <span class="ot">&lt;-</span> volcano[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(volcano), <span class="at">by =</span> <span class="dv">3</span>), <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(volcano), <span class="at">by =</span> <span class="dv">3</span>)]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">setExtent</span>(<span class="fu">raster</span>(volcano), <span class="fu">extent</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">200</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>qm <span class="ot">&lt;-</span> <span class="fu">quadmesh</span>(r)</span></code></pre></div>
<p>If you have the rgl package installed you can run the following code
to produce an interactive plot.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgl)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>scl <span class="ot">&lt;-</span> <span class="cf">function</span>(x) (x <span class="sc">-</span> <span class="fu">min</span>(x))<span class="sc">/</span><span class="fu">diff</span>(<span class="fu">range</span>(x))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shade3d</span>(qm, <span class="at">col =</span> <span class="fu">grey</span>(<span class="fu">scl</span>(qm<span class="sc">$</span>vb[<span class="dv">3</span>,qm<span class="sc">$</span>ib])))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#rglwidget()</span></span></code></pre></div>
<p>A “quadmesh” is a dense mesh describing a topologically continuous
surface of 4-corner primitives. I.e. a grid, without the “regular”. This
is useful particularly when combined with map projections and texture
mapping.</p>
<p>We are not limited to a regular grid, trivially let’s distort the
mesh by a weird scaling factor.</p>
<p>The topology of the grid is still sound, but we are no longer bound
to the regular constraint.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>qm1 <span class="ot">&lt;-</span> <span class="fu">quadmesh</span>(r)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>qm1<span class="sc">$</span>vb[<span class="dv">1</span>,] <span class="ot">&lt;-</span> qm<span class="sc">$</span>vb[<span class="dv">1</span>,] <span class="sc">*</span> qm<span class="sc">$</span>vb[<span class="dv">2</span>,]<span class="sc">/</span><span class="dv">54</span></span></code></pre></div>
<p>If you have the rgl package installed you can run the following code
to produce an interactive plot.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">open3d</span>()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shade3d</span>(qm1, <span class="at">col =</span> <span class="fu">grey</span>(<span class="fu">scl</span>(qm1<span class="sc">$</span>vb[<span class="dv">3</span>,qm1<span class="sc">$</span>ib])))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#rglwidget()</span></span></code></pre></div>
</div>
<div id="why-quadmesh" class="section level1">
<h1>Why quadmesh?</h1>
<p>Why meshes at all?</p>
<p>The simplest kind of mesh is a basic raster. Consider a matrix of 12
values.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>))</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   10
## [2,]    2    5    8   11
## [3,]    3    6    9   12</code></pre>
<p>On its own this matrix has absolutely nothing to do with spatial
data, it is literally a collection of 12 numeric values in a given
order, and by the magic of programming we’ve nominated a shape of 3x4.
We can’t help but think about this shape spatially however, but there’s
a problem. Does each element occupy space or should we consider them to
be infinitesimal locations?</p>
<p>R provides either interpretation (to simplify this story we nominate
locations for the rows and columns explicitly).</p>
<p>When considered as an image, each matrix element occupies a certain
space in width and height, but when considered as a point set the
numbers simply float at the given locations. Which is correct? (Spoiler:
Both are correct, it simply depends what we are doing.)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(m)) <span class="sc">-</span> <span class="fl">0.5</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(m)) <span class="sc">-</span> <span class="fl">0.5</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(x, y, m)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">expand.grid</span>(x, y), <span class="at">lab =</span> m[])</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The raster package defaults to the image interpretation and helpfully
assumes the values are nominally at the centre points as shown above. We
have to nominate the extent or we end up in 0,1 range, we also have to
invert the order of the values because raster counts from the top of the
page and R’s matrix uses <a href="https://CRAN.R-project.org/package=reticulate/vignettes/arrays.html">column-major
order</a>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>(r <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="fu">t</span>(m[, <span class="fu">ncol</span>(m)<span class="sc">:</span><span class="dv">1</span>]), <span class="at">xmn =</span> <span class="dv">0</span>, <span class="at">xmx =</span><span class="fu">ncol</span>(m), <span class="at">ymn =</span> <span class="dv">0</span>, <span class="at">ymx =</span> <span class="fu">nrow</span>(m)))</span></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 4, 3, 12  (nrow, ncol, ncell)
## resolution : 1.333333, 0.75  (x, y)
## extent     : 0, 4, 0, 3  (xmin, xmax, ymin, ymax)
## crs        : NA 
## source     : memory
## names      : layer 
## values     : 1, 12  (min, max)</code></pre>
<p>R’s image and rasters in general are so efficient because they only
store this minimal amount of information: the actual data values, and
the extent and dimensions of the space they occur in. If we had to store
the centre coordinate of every cell, or worse the corner coordinates
then the data storage goes up dramatically. Every software that deals
well with these kinds of data has to treat these coordinates as
implicit. We can easily expand the centre coordinates.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>xyz <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(r, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xyz)</span></code></pre></div>
<pre><code>##           x     y layer
## 1 0.6666667 2.625    10
## 2 2.0000000 2.625    11
## 3 3.3333333 2.625    12
## 4 0.6666667 1.875     7
## 5 2.0000000 1.875     8
## 6 3.3333333 1.875     9</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(xyz)</span></code></pre></div>
<pre><code>##            x     y layer
## 7  0.6666667 1.125     4
## 8  2.0000000 1.125     5
## 9  3.3333333 1.125     6
## 10 0.6666667 0.375     1
## 11 2.0000000 0.375     2
## 12 3.3333333 0.375     3</code></pre>
<p>but to expand the corners we have to jump through some hoops and even
then we get <em>every instance</em> of the corners, not only for each
cell but to explicitly close the cell as a polygon.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as</span>(<span class="fu">as</span>(raster<span class="sc">::</span><span class="fu">rasterToPolygons</span>(r), <span class="st">&quot;SpatialLinesDataFrame&quot;</span>), </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;SpatialPointsDataFrame&quot;</span>)</span></code></pre></div>
<pre><code>## class       : SpatialPointsDataFrame 
## features    : 60 
## extent      : 0, 4, 0, 3  (xmin, xmax, ymin, ymax)
## crs         : NA 
## variables   : 4
## names       : layer, Lines.NR, Lines.ID, Line.NR 
## min values  :     1,        1,        1,       1 
## max values  :    12,       12,        9,       1</code></pre>
<p>There are only 20 unique coordinates at the corners, which is where
quadmesh comes in.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quadmesh)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>qm <span class="ot">&lt;-</span> <span class="fu">quadmesh</span>(r)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(qm)</span></code></pre></div>
<pre><code>## List of 8
##  $ vb             : num [1:4, 1:20] 0 3 11 1 1.33 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:4] &quot;x&quot; &quot;y&quot; &quot;z&quot; &quot;1&quot;
##   .. ..$ : NULL
##  $ ib             : int [1:4, 1:12] 1 2 6 5 2 3 7 6 3 4 ...
##  $ primitivetype  : chr &quot;quad&quot;
##  $ material       : list()
##  $ normals        : NULL
##  $ texcoords      : NULL
##  $ raster_metadata:List of 7
##   ..$ xmn  : num 0
##   ..$ xmx  : num 4
##   ..$ ymn  : num 0
##   ..$ ymx  : num 3
##   ..$ ncols: int 3
##   ..$ nrows: int 4
##   ..$ crs  : chr NA
##  $ crs            : chr NA
##  - attr(*, &quot;class&quot;)= chr [1:3] &quot;quadmesh&quot; &quot;mesh3d&quot; &quot;shape3d&quot;</code></pre>
<p>This is a mysterious seeming data structure, it is the mesh3d type of
the ‘rgl’ package, rarely seen in the wild.</p>
<p>The structure is <code>vb</code>, the coordinates of the mesh - these
are the actual corner coordinates from the input raster.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(r)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">NA</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">t</span>(qm<span class="sc">$</span>vb), <span class="at">lab =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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JqD4vR07dojIX//618qRdu3anT179ujRo9qFwm0rKyvbt2/fpUuXWrRo0bJlSxsbm8zMzNatW2udCzeUlpbWp0+f2NjY/fv39+3bt3Lcy8vLYDAcOnSocuTw4cN+fn61nUcvBWbNh/keOnTo+++/79evX81uFlZTcRRo69atlSNbt251cnJq2rSpdqFQHR06dIiPj694febMmdTU1CeeeELbSLgRk8k0YsSIQYMGLViw4JoLvN3c3CIiIpKTkyvfuWbNmtjYa6+9qnG6mIJY+WG+GzZssLW1ve+++2pqg7Cy++67r1evXsOHD3/ttdcCAwO3bNkyc+bM+Ph4e3t7raPhNtjb2w8fPjwxMTEwMNBoNM6cOfPuu+9+/PHHtc6F69u8eXNeXp6Pj8+HH35YddxisYjIuHHjevfuPWXKlO7duy9cuLCwsHDUqFG1HUkXBfbSSy917dr1ug/znTt37tChQ8eNG3fnD/OttHHjxtatW9/ihSHQp88//3zatGnz588/depUQEDAwoULr7kLHkp48803bWxsXn/9dVtb227duiUkJLi5uWkdCtd3+PBhEZk5c+Y14y1bthSRqKio5cuXz5o1KyEhoV27dhs3bmzWrFltR9LF0+jd3Nzef//9/v37X3ftN99807t37zs/K9axY8e5c+d26MB18zXp5Zdf9vDwmDBhgtZB6pTU1NR333236mM8cefOnz/ftGnToqIirYPUNW3atFm6dOmf92n0tfcwXwBAXaWLQ4i19DBfAEAdposCq/GH+V6XnZ0d183XODs7Oy6dqHH29vb8Xa1x/F2tJRr+aNXFObBKNfUw3+s6d+5cxdyupjYIEbl06ZKtre3NH5qM21VeXn7hwoU682AR/Th79mxtPzXmT0jD/6v6KjAAAG6RLi7iAADgdlFgAAAlUWAAACVRYAAAJVFgAAAlUWAAACVRYAAAJVFgAAAlUWAAACVRYAAAJVFgAAAl/SkKbOXKlffdd1/Dhg27deu2Z88erePUKenp6fy7izVr/vz5HTp0cHV1DQ4Onj17tslk0jqR8i5evPj3v//d39/fxcWlXbt2SUlJWieqa9LS0r744gvr77fuF9iaNWsGDBjQrl27xYsXOzo6hoeH5+bmah2qjjCbzZMnT96yZYvWQeqOadOmjR49unPnzsuXL3/kkUcmTZo0ZcoUrUMp79ln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" /><!-- --></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(op)</span></code></pre></div>
<p>Notice how these are unique coordinates, there’s no simple
relationship between the cell and its value and its four corners. This
is because they are shared between neighbouring cells. The relationship
is stored in the <code>ib</code> array, this has four rows one for each
corner of each cell. There are 12 cells and each has four coordinates
from the shared vertex pool. The cells are defined in the order they
occur in raster.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>qm<span class="sc">$</span>ib</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]
## [1,]    1    2    3    5    6    7    9   10   11    13    14    15
## [2,]    2    3    4    6    7    8   10   11   12    14    15    16
## [3,]    6    7    8   10   11   12   14   15   16    18    19    20
## [4,]    5    6    7    9   10   11   13   14   15    17    18    19</code></pre>
<p>It works directly with rgl function, and can be used in more raw
form.</p>
<p>If you have the rgl package installed you can run the following code
to produce an interactive plot.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rgl.clear</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgl)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shade3d</span>(qm)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rglwidget</span>()</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rgl.clear</span>()</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">quads3d</span>(<span class="fu">t</span>(qm<span class="sc">$</span>vb)[qm<span class="sc">$</span>ib,], <span class="at">col =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;black&quot;</span>), <span class="at">each =</span> <span class="dv">4</span>))</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">aspect3d</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">#rglwidget()</span></span></code></pre></div>
<p>The primary means to create this format from a raster is for 3D
plotting, but because we have access to the coordinate directly it
provides other uses. We can transform the coordinates (i.e. a map
projection) or manipulate them and augment the Z value (for example) in
flexible ways.</p>
<p>(The usual way of driving rgl grid surfaces is
<code>rgl.surface</code> but this is limited to the centre-point
interpretation only - more than the x, y, z list interface as image()
is, i.e. it can take an individual x,y pair for every cell, but it
cannot properly represent the cell-as-area as image can. For this we
need to use <code>shade3d</code>, and actual <code>meshd3d</code> types
in <code>rgl</code>).</p>
</div>
<div id="triangle-mesh" class="section level1">
<h1>Triangle mesh</h1>
<p>Alternatively the centre-of-cell interpretation of a raster is
available.</p>
<p>If you have the rgl package installed you can run the following code
to produce an interactive plot.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rgl.clear</span>()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wire3d</span>(qm)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>tm <span class="ot">&lt;-</span> <span class="fu">triangmesh</span>(r)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">shade3d</span>(tm, <span class="at">col =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;firebrick&quot;</span>, <span class="st">&quot;dodgerblue&quot;</span>, <span class="st">&quot;grey&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#rglwidget()</span></span></code></pre></div>
</div>
<div id="discrete-forms" class="section level1">
<h1>Discrete forms</h1>
<p>There is a discrete form for both quad and triangles meshes. See how
each quad has a constant z-value.</p>
<p>If you have the rgl package installed you can run the following code
to produce an interactive plot.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dqm <span class="ot">&lt;-</span> <span class="fu">dquadmesh</span>(r)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rgl.clear</span>()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shade3d</span>(dqm)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#rglwidget()</span></span></code></pre></div>
<p>When the centre-point interpretation of <em>triangles</em> are
discrete we actually need to modify their vertices to see that they are
separable.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dtm <span class="ot">&lt;-</span> <span class="fu">dtriangmesh</span>(r)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>dtm<span class="sc">$</span>vb[<span class="dv">3</span>, ] <span class="ot">&lt;-</span> <span class="fu">jitter</span>(dtm<span class="sc">$</span>vb[<span class="dv">3</span>, ], <span class="dv">8</span>)</span></code></pre></div>
<p>If you have the rgl package installed you can run the following code
to produce an interactive plot.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rgl.clear</span>()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shade3d</span>(dtm, <span class="at">col =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;firebrick&quot;</span>, <span class="st">&quot;dodgerblue&quot;</span>, <span class="st">&quot;grey&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#rglwidget()</span></span></code></pre></div>
</div>
<div id="quadmesh-is-a-special-case" class="section level1">
<h1>Quadmesh is a special case</h1>
<p>All quad meshes may be specified trivially as a triangular mesh,
there’s a straightforward re-indexing from quads to triangles by
splitting each set of four into two sets of three. If the quad mesh is
regular there’s a literal ambiguity about the best choice (diagonal up,
or down?) which leads us to the real value of a triangulated mesh. The
triangle mesh may be denser or coarser depending on need, something that
a regular grid cannot do. Mesh creation is a dark and difficult science,
but has been formalized with a strong math basis in recent years. It’s
still hard to do constrained polygon triangulation, and this lack
probably drove the transition of topology GIS to modern SF GIS more than
any other issue.</p>
<p>But, modern meshing is now very well established, but its use in open
and free contexts is still relatively rare. (We can see this changing in
Javascript and D3 in particular.)</p>
<p>Physical modellers, engineering construction, fluid hydrodynamics use
these techniques in detail, but finite-element level model is rarely
applied in GIS contexts.</p>
</div>
<div id="topology-and-geometry-are-completely-separable" class="section level1">
<h1>Topology and geometry are completely separable</h1>
<p>Consider two kinds of meshes, a simple triangulation and a short
piecewise line composed of segments. The triangles and segments both
<em>fill space</em> in a particular way, they inhabit 2D and 1D topology
in a way that is independent of the actual geometric space in use. We
can flatten the triangles into a plane or lay the line segments each at
right angles to each other without changing this topological relation,
as a mesh the triangles will still have the same neighbours and and the
line will still have the same segments in the same order. The geometry
is specified by the vertices between these topological elements, and we
may define these in x,y, in x,y,z or x,y,z,time - or in any
<em>geometric</em> space we choose.</p>
<p><em>planar and rgl plots of meshes</em></p>
<p>The topology itself may need to be defined in a particular origin
geometry, and for example the Delaunay triangulation for connecting
planar x,y points gives a particular mesh - but once this is defined we
can transform the original geometry (say it was UTM, zone 55 south) into
a global Lambert Azimuthal Equal Area, or onto a geocentric shell with
radius 637187m - the relationship between the primitives (triangles,
edges) does not change. Not all geometries make sense for a given mesh,
but with a mesh we are quite free to choose amongst many sensible
alternatives, the primitives provide a straightforward interpolative
space along with other physical properties might be assumed to vary.
This is the basis of barycentric interpolation and simplistic linear
interpolation with depth over time, for example.</p>
</div>
<div id="geometry-is-purely-a-table-of-attributes" class="section level1">
<h1>Geometry is purely a table of attributes</h1>
<p>It’s the mesh indexing of how the primitives relate to a given
geometry that matters, not the original (or particular) geometry in
play. This means that if we triangulate in the local coordinate system
but then map the mesh in a different one it will no longer “be
Delaunay”.</p>
<p>This also opens up the idea that we can store multiple coordinate
system choices in one data set.</p>
<p>There are efficiencies for different kinds of mesh, for raster we
need only store the cell values and the offset and scale to position the
grid. It’s completely parameterized, and if we need the centre or corner
coordinates they are implicit, no need to generate them. If we store a
connected triangular mesh, it becomes wasteful to store every path
around each triangle as coordinates, and it’s actually error-prone
because we need to update all instances of coordinates at any shared
boundary. A better approach is to keep the index of each triangle,
against a set of shared vertices. We can augment the vertices, transform
them and so on and because they are uniquely defined the mesh is
automatically correctly updated with no gaps.</p>
</div>
<div id="point-clouds-are-pure-geometry" class="section level1">
<h1>Point clouds are pure geometry</h1>
<p>Point clouds provide a range of implicit shapes from set of raw
geometry. There’s the “ground”, and some challenging algorithms exist to
identify which points best represent this particular surface in a set of
points. We can define this set of ground points <em>implicitly</em>, by
storing a reference to the relevant vertices from the entire set. If we
use this to actually <em>connect the points</em> together then we still
store those indexes in triplets, the triangulation of those points in
the X-Y plane. Notice how the points are connnected together in a
nominated X-Y space, it doesn’t matter where the Z value/s are, they
only contributed to the choice of ground points. There’s a chain of
implicit, indexed structures that we can construct from these samples of
raw geometry. Other algorithms might include the spectral properties or
other measurements for the particular definition of the target
surface.</p>
</div>
<div id="polygons-and-lines-in-gis-are-piecewise-graphs" class="section level1">
<h1>Polygons and lines in GIS are piecewise graphs</h1>
<p>From the mesh perspective SF types are <em>explicitly described
piecewise shapes. Every coordinate is stored explicitly as it occurs,
but we can flip this view and rather store the entities involved (and
</em>name them<em>) together. There are vertices and edges, and these
are grouped into higher entities such as </em>paths<em>, and paths are
grouped together as </em>lines or polygons*, and these are further
grouped into features. By storing each element in its own set we have
opportunity for explicit topology (shared vertices, shared edges).</p>
<p>We <em>lose</em> the ability to arbitrarily transmit atomic features
around, but this can easily be achieved for a given set of features
anyway.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
